{% extends 'base.html.twig' %}

{% block body %}
<div class="max-w-lg mx-auto mt-10 bg-white p-8 rounded shadow">
    <h1 class="text-2xl font-bold mb-6 text-blue-600">{{ workspace.name }}</h1>
    <p class="mb-4"><strong>Propriétaire :</strong> {{ workspace.owner.firstName }} {{ workspace.owner.lastName }}</p>
    <a href="{{ path('app_workspace_edit', {'id': workspace.id}) }}" class="text-green-600 hover:underline mr-4">Modifier l'espace de travail</a>
    {% if app.user and workspace.owner.id == app.user.id %}
        <a href="{{ path('app_workspace_invite', {'id': workspace.id}) }}" class="text-blue-600 hover:underline mr-4">Inviter un membre</a>
    {% else %}
        <span class="text-gray-400 mr-4">Pour inviter un membre, veuillez vous rapprocher de {{ workspace.owner.firstName }} {{ workspace.owner.lastName }} </span>
    {% endif %}
    <a href="{{ path('app_workspace_index') }}" class="text-blue-600 hover:underline">Retour à la liste</a>
    <hr class="my-4">
    <h2 class="mt-6 font-bold">Membres de l'espace de travail</h2>
    <ul>
        {% set members = [] %}
        {% for project in workspace.projects %}
            {% for membership in project.memberShips %}
                {% set user = membership.person %}
                {% if user and user.id not in members %}
                    <li>{{ user.firstName }} {{ user.lastName }} ({{ user.email }}) - {{ membership.role }}</li>
                    {% set members = members|merge([user.id]) %}
                {% endif %}
            {% endfor %}
        {% endfor %}
    </ul>
    <hr class="my-4">
    <h2>Hiérarchie actuelle de l'espace de travail "{{ workspace.name }}"</h2>
    <ul class="ml-4 mt-2">
        {% for project in workspace.projects %}
            <li>
                <span class="font-semibold text-green-700">Projet :</span> {{ project.name }}
                <ul class="ml-4">
                    {% for board in project.boards %}
                        <li>
                            <span class="font-semibold text-blue-500">Etape :</span> {{ board.name }}
                            <ul class="ml-4">
                                {% for card in board.cards %}
                                    <li>
                                        <span class="font-semibold text-gray-700">Tâche :</span> {{ card.title }}
                                    </li>
                                {% else %}
                                    <li class="text-gray-400">Aucune tâche disponible</li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% else %}
                        <li class="text-gray-400">Aucune étape disponible</li>
                    {% endfor %}
                </ul>
            </li>
        {% else %}
            <li class="text-gray-400">Aucun projet disponible</li>
        {% endfor %}
    </ul>
</div>

{% endblock %}

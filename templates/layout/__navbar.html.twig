<nav class="bg-white border-b border-gray-200 px-4 py-2.5">
    <div class="container flex flex-wrap items-center justify-between mx-auto">
        <a href="{{ path('app_home_page') }}" class="flex items-center">
            <span class="self-center text-xl font-semibold whitespace-nowrap text-blue-600">TODOWORK</span>
        </a>
        <button data-collapse-toggle="navbar-default" type="button" class="inline-flex items-center p-2 ml-3 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none" aria-controls="navbar-default" aria-expanded="false">
            <span class="sr-only">Open main menu</span>
            <svg class="w-6 h-6" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
        <div class="hidden w-full md:block md:w-auto" id="navbar-default">
            <ul class="flex flex-col p-4 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:text-sm md:font-medium md:border-0 md:bg-white">
                {% if app.user %}
                    <li>
                        <a href="{{ path('app_workspace_index') }}" class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700">Espaces de Travail</a>
                    </li>
                    {% set has_workspace = false %}
                    {% set has_projets = false %}
                    {% set has_board = false %}
                    {% set has_card = false %}
                    {% for workspace in app.user.workspaces %}
                        {% set has_workspace = true %}
                    {% endfor %}
                    {% if not has_workspace %}
                        {% for membership in app.user.memberShips %}
                            {% if membership.role == 'editor' and membership.project and membership.project.workspace %}
                                {% set has_workspace = true %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    {% if has_workspace %}
                        <li>
                            <a href="{{ path('app_project') }}" class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700">Projets</a>
                        </li>
                        {% for membership in app.user.memberShips %}
                            {% if membership.role == 'editor' and membership.project %}
                                {% set has_projets = true %}
                            {% endif %}
                        {% endfor %}
                        {% if not has_projets %}
                            {% for workspace in app.user.workspaces %}
                                {% for project in workspace.projects %}
                                    {% set has_projets = true %}
                                {% endfor %}
                            {% endfor %}
                        {% endif %}
                        {% if has_projets %}
                            <li>
                                <a href="{{ path('app_board') }}" class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700">Etapes</a>
                            </li>
                            {% for membership in app.user.memberShips %}
                                {% if membership.role == 'editor' and membership.project %}
                                    {% for board in membership.project.boards %}
                                        {% set has_board = true %}
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                            {% if not has_board %}
                                {% for workspace in app.user.workspaces %}
                                    {% for project in workspace.projects %}
                                        {% for board in project.boards %}
                                            {% set has_board = true %}
                                        {% endfor %}
                                    {% endfor %}
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                        {% if has_board %}
                            <li>
                                <a href="{{ path('app_card') }}" class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700">Tâches</a>
                            </li>
                        {% endif %}
                    {% endif %}
                    {% if 'ROLE_ADMIN' in app.user.roles %}
                        <li class="relative" x-data="{ openAdmin: false }">
                            <button type="button"
                                @click="openAdmin = !openAdmin"
                                @keydown.escape="openAdmin = false"
                                class="flex items-center gap-2 py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-yellow-700 focus:outline-none"
                                aria-haspopup="true" :aria-expanded="openAdmin.toString()">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" fill="currentColor" class="text-yellow-400" />
                                </svg>
                                <span>Admin</span>
                            </button>
                            <div
                                x-show="openAdmin"
                                @click.away="openAdmin = false"
                                class="absolute right-0 z-20 mt-2 w-56 bg-white rounded shadow-lg border border-gray-200 py-2">
                                <a href="{{ path('admin_users') }}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Gestion des Users</a>
                                <div class="border-t my-1"></div>
                                <a href="{{ path('app_label') }}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Gestion des labels</a>
                            </div>
                        </li>
                    {% endif %}
                    <li>
                        <a href="{{ path('app_schedule') }}" class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700">Emploi du temps</a>
                    </li>
                    <li class="relative" x-data="{ open: false }">
                        <button type="button"
                            @click="open = !open"
                            @keydown.escape="open = false"
                            class="flex items-center gap-2 py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 focus:outline-none"
                            aria-haspopup="true" :aria-expanded="open.toString()">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
                                <path stroke="currentColor" stroke-width="2" fill="none" d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
                            </svg>
                        </button>
                        <div
                            x-show="open"
                            @click.away="open = false"
                            class="absolute right-0 z-10 mt-2 w-48 bg-white rounded shadow-lg border border-gray-200"
                        >
                            <div class="px-4 py-2 text-gray-700 border-b">{{ app.user.firstName }} {{ app.user.lastName }}</div>
                            <a href="{{ path('app_user') }}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Mon profil</a>
                            <a href="{{ path('app_logout') }}" class="block px-4 py-2 text-red-600 hover:bg-gray-100">Déconnexion</a>
                        </div>
                    </li>
                {% else %}
                    <li>
                        <a href="{{ path('app_login') }}" class="block py-2 pl-3 pr-4 text-blue-600 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700">Connexion</a>
                    </li>
                    <li>
                        <a href="{{ path('app_register') }}" class="block py-2 pl-3 pr-4 text-green-600 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-green-700">Inscription</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>
